var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},Datajo;(function(n){var u=function(){function n(n,i,r){if(r.action!==n)throw new t("'"+n+"' action expected");if(r.target===undefined||r.target.trim()==="")throw new t("Target of the action has not been defined");this.sender=i,this.action=r.action,this.target=r.target}return n}(),r=function(){function n(){}return n.prototype.execute=function(){},n}(),h=function(){function n(n){var i=n.activityIndicator,t;i===undefined||i.trim()===""?(this.showMe=function(){},this.hideMe=function(){}):(t=$(i),t.hide(),this.showMe=function(){t.show()},this.hideMe=function(){t.hide()})}return n.prototype.show=function(){this.showMe()},n.prototype.hide=function(){this.hideMe()},n}(),s=function(n){function i(i,r,u){if(n.call(this,i,r,u),u.url===undefined||u.url.trim()==="")throw new t("Url has not been defined");if(this.url=u.url,this.inject=u.inject===undefined||u.inject.trim()===""?"replaceContent":u.inject,!e.exists(this.inject))throw new t("Unknown injection type: "+this.inject);this.confirm=u.confirm}return __extends(i,n),i.prototype.confirmed=function(){return this.confirm===undefined||this.confirm.trim()===""||confirm(this.confirm)},i}(u),c=function(){function n(){}return n}(),l=function(){function n(){var n=this;this.debugMode=k.find("datajo")==="debug",$(window).resize(function(){return n.setViewerSize()})}return n.prototype.prepareMessage=function(n,t){return"Status:      "+t.status+"\nStatus Text: "+t.statusText+"\nResponse Text:\n"+t.responseText+"\n------------------------"},n.prototype.showError=function(n,t){var f=t.getResponseHeader("Content-Type"),s=i.isString(f)&&f.toLowerCase().indexOf("text/html")>=0,e=$("body");e.prepend('<div id="datajo-debug" style="font-size:.9em;padding:0px;z-index:10000;position:absolute;top:0px;left:0px;width:100%;background-color:#f00;color:#fff"><table style="margin:0px;padding:0px;width:100%;border:0px;"><tr><td style="height:1px; padding:10px 20px 0px 20px;"><button style="float:right;font-weight:bold;color:#fff;background-color:#f00;border:0px;">x<\/button><h3 style="margin:0px;padding:0px;">Datajo Ajax Error<\/h3>Status: '+t.status+"<br />Status Text: "+t.statusText+'<br>Headers: <div style="margin-left:30px;">'+t.getAllResponseHeaders().replace(/\n/g,"<br />")+'<\/div><\/td><\/tr><tr><td style="padding: 20px;"><iframe style="width:100%;border:solid 1px #f00;"><\/iframe><\/td><\/tr><\/table><\/div>');var r=$("#datajo-debug"),h=r.find("button").click(function(){r.replaceWith("")}),o=r.find("iframe"),u=o.get(0).contentDocument;u.open(),u.write(t.responseText),u.close(),this.setViewerSize()},n.prototype.setViewerSize=function(){var n=$("#datajo-debug"),t;n!==undefined&&(t=$(window).outerHeight(),n.height(t),n.find("table").height(t),n.find("iframe").height(t-n.find("td:first").height()-60))},n.prototype.onAjaxError=function(n,t,i,r){n.type==="ajaxError"&&(this.debugMode&&this.showError(n,t,i,r),console!==undefined)&&console.error(this.prepareMessage(n,t,i,r))},n}(),f=function(){function n(){}return n.events={click:function(){return!0},load:function(){return!0},submit:function(n){return i.normalize(n.tagName)==="form"}},n.extract=function(n,r){if(!r)throw new t("HTML element has not been provided");var u=i.isString(n.event)?i.normalize(n.event):"click";if(u===""&&(u="click"),this.events[u]===undefined)throw new t("Event "+u+" has not been recognized");if(this.events[u](r))return u;throw new t('Event "'+u+'" is not supported by "'+r.tagName+'" tag.');},n}();n.EventName=f;var t=function(){function n(n){this.message=n}return n.prototype.toString=function(){return"Datajo exception: "+this.message},n}(),a=function(n){function t(t,i){n.call(this,"get",t,i)}return __extends(t,n),t}(s),v=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var r=this,i=new a(n,t);i.confirmed()&&$.get(i.url,function(n){r.onSuccess(i,n)})},t.prototype.onSuccess=function(n,t){e.inject(n,t)},t}(r),y=function(n){function t(t,i){n.call(this,"hide",t,i),this.duration=i.duration,this.easing=i.easing}return __extends(t,n),t}(u),p=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var i=new y(n,t),r=o.resolve(i);r.hide(i.duration===undefined?200:i.duration,i.easing===undefined?"linear":i.easing)},t}(r),e=function(){function n(){}return n.injections={replaceContent:function(n,t){n.html(t)},afterContent:function(n,t){n.append(t)},beforeContent:function(n,t){n.prepend(t)},replaceTarget:function(n,t){n.replaceWith(t)},beforeTarget:function(n,t){n.before(t)},afterTarget:function(n,t){n.after(t)}},n.exists=function(t){return n.injections[t]!==undefined},n.inject=function(i,r){if(!n.exists(i.inject))throw new t("Unknown injection type: "+i.inject);n.injections[i.inject](o.resolve(i),r)},n}(),w=function(n){function r(r,u){if(n.call(this,"post",r,u),u.form===undefined||i.normalize(u.form)==="")throw new t("Form has not been defined");if(this.form=i.normalize(u.form)==="_self"?this.sender:$(u.form).get(0),this.form.tagName.toLowerCase()!=="form")throw new t("Element identified by '"+u.form+"' selector is not a form");this.validate=u.validate!==undefined&&i.isBool(u.jqvalidate)?u.jqvalidate:!0}return __extends(r,n),r}(s),b=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var u=this,i=new w(n,t),r=$(i.form);(!i.validate||$.validator===undefined||r.valid())&&i.confirmed()&&$.post(i.url,r.serializeArray(),function(n){u.onSuccess(i,n)})},t.prototype.onSuccess=function(n,t){e.inject(n,t)},t}(r),k=function(){function n(){}return n.find=function(n){for(var i=location.search.substring(1),r=/([^&=]+)=([^&]*)/g,t;t=r.exec(i);)if(decodeURIComponent(t[1])===n)return decodeURIComponent(t[2]);return undefined},n}(),d=function(){function n(){}return n.prototype.findNotConfiguredElements=function(){var n=[];return $("[data-jo]").each(function(t,i){i.datajo===undefined&&n.push(i)}),n},n}(),g=function(){function n(){var n=this;$(document).ajaxStart(function(){return n.onAjaxStart()}),$(document).ajaxComplete(function(){return n.onAjaxComplete()}),this.errorHandler=new l,$(document).ajaxError(function(t,i,r,u){return n.errorHandler.onAjaxError(t,i,r,u)}),this.repo=new d,this.config=this.getConfiguration(),this.handlers={show:new tt,hide:new p,get:new v,post:new b},this.activityIndicator=new h(this.config),this.update()}return n.prototype.getConfiguration=function(){var n=$(document.body).data("jo-config");return n===undefined?new c:n},n.prototype.update=function(){var u=this,i=this.repo.findNotConfiguredElements(),r,n,t;for(r in i){n=i[r],n.datajo=this.findData(n);for(t in n.datajo){$(n).on(t,function(n){return u.onevent(n)});t=="load"&&$(n).trigger("load")}}$.validator!==undefined&&$.validator.unobtrusive!==undefined&&$.validator.unobtrusive.parse("form")},n.prototype.onAjaxStart=function(){this.activityIndicator.show()},n.prototype.onAjaxComplete=function(){this.update(),this.activityIndicator.hide()},n.prototype.findData=function(n){var s,u,t,r,o,e;for(s in n.attributes)if(u=n.attributes[s],u!==undefined&&u.name==="data-jo"){if(t=JSON.parse(u.value),r={},i.isArray(t))for(o in t)e=f.extract(t[o],n),r[e]===undefined&&(r[e]=[]),r[e].push(t[o]);else r[f.extract(t,n)]=[t];return r}return undefined},n.prototype.onevent=function(n){var t,i,r;for(n.preventDefault(),t=n.target;t.datajo===undefined;)t=$(t).parent().get(0);i=t.datajo[n.type];for(r in i)this.handlers[i[r].action].execute(t,i[r])},n}(),nt=function(n){function t(t,i){n.call(this,"show",t,i),this.duration=i.duration,this.easing=i.easing}return __extends(t,n),t}(u),tt=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.execute=function(n,t){var i=new nt(n,t),r=o.resolve(i);r.show(i.duration===undefined?200:i.duration,i.easing===undefined?"linear":i.easing)},t}(r),o=function(){function n(){}return n.resolvers={_parent:function(n){return $(n.sender.parentNode)},_self:function(n){return $(n.sender)}},n.resolve=function(t){return n.resolvers[t.target]!==undefined?n.resolvers[t.target](t):$(t.target)},n}(),i=function(){function n(){}return n.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"},n.isString=function(n){return Object.prototype.toString.call(n)=="[object String]"},n.isBool=function(n){return Object.prototype.toString.call(n)=="[object Boolean]"},n.normalize=function(n){return n.trim().toLowerCase()},n}();n._=i,$(function(){var n=new g})})(Datajo||(Datajo={}))